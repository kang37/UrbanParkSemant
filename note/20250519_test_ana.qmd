---
title: "测试分析"
author: "Kang"
format: html
editor: visual
editor_options: 
  chunk_output_type: console
---

## 引言

**提醒：看分析之前可以先想想我们可以做什么、怎么做，避免被我这个分析小样限制了思路；这个分析小样只是很初步的一个预分析，主要展示一下这样的研究通常怎么做，里头有很多简化甚至是错误的内容，可以之后再详细讨论。**

目的：人们对公园的看法分析。

方法：以筑波市5个公园为小样，下载各公园的谷歌地图评价，包括用户名、评价时间、评分、评价文本等；基于情感分析，探究各公园评价的积极或消极程度；基于文本分析中的主题分析，探究公园整体评价所涉及的主要主题，和差评部分涉及的主要主题。

## 基本情况

可见两个大公园（洞峰和赤冢）评价比其他小公园多得多。注意这里的数量并非评价总数，而是符合一定条件的才会被抓下来，比如包含谷歌地图review文本、评级等等（似乎是），而且如果一个地点谷歌评价太多的话，只能抓取最近的几百条。

```{r}
gm_review %>% 
  group_by(name) %>% 
  summarise(n = n(), .groups = 'drop') %>% 
  ggplot() + 
  geom_col(aes(name, n)) +
  theme_bw() + 
  theme(axis.text.x = element_text(angle = 90))
```

## 情感分析

情感分析可以判断各个文本的情感得分，积极则得分大于0，消极则小于0。每个评价文本的情感得分和文本中每个词的情感得分是有关的，简单来说，一个文本的情感得分可以看作是当中每个词的情感得分之和。所以，我们首先来看看所有公园文本中词语的得分。这种图主要关注高频高极性（可以理解为非常积极或消极则极性高）的词语们。

```{r}
textplot_terms(lss)
```

然后看看各公园各文本的得分，下图中每个点代表一条评价文本的情感得分。可见大公园的得分比较参差，小公园比较一致，尽管这也和评价数量有关。总体来说，中位数都在中性（0）附近。

```{r}
ggplot(lss_score %>% filter(
  review_time == "1 year" | review_time == "2-3 year" | review_time == "4-6 year"
), aes(name, fit)) + 
  geom_violin() + 
  geom_jitter(alpha = 0.5) + 
  theme_bw() + 
  theme(axis.text.x = element_text(angle = 90)) + 
  coord_cartesian(ylim = c(-2.5, 2.5))
```

## 主题分析

以所有文本为对象，解析各公园涉及的主题，各公园主要的3个主题关键词如下。可见：关键词反映出公园用得比较多的设施，例如洞峰公园的游泳池和咖啡馆。

```{r}
lapply(lda_model_loc, terms, k = 10)
```

只提取出差评进行主题分析，结果表明了公园可以改进的地方。例如，可以看到洞峰公园出现了一些抱怨泳池的关键词，例如\"閉館\"------回到文本我们会发现主要是抱怨闭馆时间。

```{r}
lapply(lda_model_loc_neg, terms, k = 10)
```

此外，尽管是个测试分析，这里反映出两个分析上的问题：差评数量太少；单看关键词未必能够理解主题内容，因此再进行文本分析后还是要回到文本中去查看。可能的解决办法：或许扩大分析样本后这个问题可以解决；对于每个公园，下载公园范围内所有兴趣点的review。其他想法：或许还可以看看公园和附近其他兴趣点之间的评分是否相互影响，例如，评价比较高的公园附近的餐厅是否也分数更高。
